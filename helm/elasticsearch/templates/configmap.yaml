apiVersion: v1
kind: ConfigMap
metadata:
  name: elasticsearch-config
  namespace: {{ .Values.namespace }}
  labels:
    app: elasticsearch
    managed-by: helm
data:
  elasticsearch.yml: |
    # Cluster & Node Identity
    cluster.name: {{ .Values.elasticsearch.cluster.name }}
    node.name: ${HOSTNAME}
    node.roles: [{{ .Values.elasticsearch.nodeRoles }}]
    
    # Cluster Discovery
    discovery.seed_hosts:
      - elasticsearch-headless.{{ .Values.namespace }}.svc.cluster.local
    cluster.initial_master_nodes:
      - es-0
      - es-1
      - es-2
    
    # Network
    network.host: 0.0.0.0
    transport.host: 0.0.0.0
    transport.port: 9300
    transport.publish_host: ${HOSTNAME}.elasticsearch-headless.{{ .Values.namespace }}.svc.cluster.local
    
    # Shard Allocation
    cluster.routing.allocation.total_shards_per_node: {{ .Values.elasticsearch.shard.allocationTotalShardsPerNode }}
    
    # Security (Disabled for dev/test)
    xpack.security.enabled: false
    
    # Storage & Logs
    path.data: /usr/share/elasticsearch/data
    path.logs: /usr/share/elasticsearch/logs
    
    # Performance
    indices.memory.index_buffer_size: {{ .Values.elasticsearch.indices.memoryIndexBufferSize }}
    thread_pool.write.queue_size: {{ .Values.elasticsearch.threadPool.writeQueueSize }}
    transport.connect_timeout: {{ .Values.elasticsearch.transport.connectTimeout }}
    transport.tcp.keep_alive: {{ .Values.elasticsearch.transport.tcpKeepAlive }}
    
    # Recovery & Resilience
    action.destructive_requires_name: {{ .Values.elasticsearch.actionDestructiveRequiresName }}
    indices.recovery.max_bytes_per_sec: {{ .Values.elasticsearch.indices.recoveryMaxBytesPerSec }}
    cluster.routing.allocation.node_concurrent_recoveries: {{ .Values.elasticsearch.cluster.nodeConcurrentRecoveries }}
